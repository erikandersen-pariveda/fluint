<project name="fluintLibrary" basedir="." default="package">
	
	<!-- User defined properties -->
	<property name="flex.home" location=""/>
	<property name="fluint.testrunner" location=""/>

	<!-- Folders -->
	<property name="src.loc" location="${basedir}/src" />
	<property name="src.main.loc" location="${src.loc}/main/flex" />
	<property name="src.main.manifest" location="${src.main.loc}/fluint-manifest.xml" />
	<property name="src.test.loc" location="${src.loc}/test/flex" />
	<property name="bin.loc" location="${basedir}/target" />
	<property name="bin.main.loc" location="${bin.loc}/classes" />
	<property name="bin.main.name" value="fluint.swc" />
	<property name="bin.main.namespace" value="http://www.digitalprimates.net/2008/fluint" />
	<property name="bin.test.loc" location="${bin.loc}/test-classes" />
	<property name="bin.test.name" value="FluintDefaultAirRunner.swf" />
	<property name="report.loc" location="${bin.loc}/report" />
	<property name="package.loc" location="${bin.loc}" />
	<property name="package.artifact.name" value="${bin.main.name}" />
	<property name="doc.loc" location="${bin.loc}/doc" />
	
	<target name="clean">
        <delete dir="${bin.loc}" />
    </target>
	
	<target name="init">
		<mkdir dir="${bin.loc}" />
		<mkdir dir="${bin.main.loc}" />
		<mkdir dir="${bin.test.loc}" />
		<mkdir dir="${report.loc}" />
		<mkdir dir="${doc.loc}" />
	</target>
	
	<target name="build" depends="init">
		<!-- Compile source SWC -->
		<exec executable="${flex.home}/bin/compc" dir="${basedir}" failonerror="true">
			<arg line="-namespace ${bin.main.namespace} '${src.main.manifest}'" />
			<arg line="-include-namespaces ${bin.main.namespace}" />
			<arg line="-output '${bin.main.loc}/${bin.main.name}'" />
			<arg line="-source-path+='${src.main.loc}'" />
			<arg line="-source-path+='${src.test.loc}'" />
			<arg line="-include-sources+='${src.test.loc}'" />
		</exec> 
    </target>
	
	<target name="package" depends="build">
		<!-- Generate ASDocs -->
		<exec dir="${basedir}" executable="${flex.home}/bin/asdoc" failonerror="true">
			<arg line="-namespace ${bin.main.namespace} '${src.main.manifest}'" />
			<arg line="-doc-sources '${src.main.loc}'" />
			<arg line="-source-path+='${src.main.loc}'" />
			<arg line="-output '${doc.loc}'" />
		</exec>
		
		<copy file="${bin.main.loc}/${bin.main.name}" tofile="${package.loc}/${package.artifact.name}" />
	</target>
	
	<!-- Optional target -->
	<target name="test">
		<!-- Imported tasks -->
		<taskdef name="fluint" classname="net.digitalprimates.ant.tasks.fluint.Fluint" />
		
		<!-- Compile test SWF -->
		<exec executable="${flex.home}/bin/mxmlc" dir="${basedir}" failonerror="true">
			<arg line="-output '${bin.test.loc}/${bin.test.name}'" />
			<arg line="-keep-generated-actionscript=false" />
			<arg line="-library-path+='${bin.main.loc}'" />
			<arg line="'${src.test.loc}/FluintDefaultAIRRunner.mxml'" />
		</exec>
		
		<!-- Execute tests -->
		<fluint headless="true" testRunner="${fluint.testrunner}" outputDir="${report.loc}" workingDir="${bin.test.loc}" failonerror="false">
			<fileset dir="${bin.test.loc}">
		    	<include name="**/${bin.test.name}" />
			</fileset>
		</fluint>
	</target>
</project>